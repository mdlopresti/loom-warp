# NATS Service Configuration
apiVersion: v1
kind: Service
metadata:
  namespace: nats-mcp
  labels:
    app: nats
  name: nats
spec:
  selector:
    app: nats
  ports:
    - name: client
      protocol: TCP
      port: 4222
      targetPort: 4222
    - name: monitor
      protocol: TCP
      port: 8222
      targetPort: 8222
---
# External access service (LoadBalancer or NodePort)
# Uncomment the type you need for external access
apiVersion: v1
kind: Service
metadata:
  namespace: nats-mcp
  labels:
    app: nats
  name: nats-external
spec:
  type: LoadBalancer  # Change to NodePort if LoadBalancer not available
  selector:
    app: nats
  ports:
    - name: client
      protocol: TCP
      port: 4222
      targetPort: 4222
      # nodePort: 30422  # Uncomment for NodePort
---
# Optional: Ingress for HTTP monitoring endpoint
# Requires cert-manager and nginx ingress controller
# apiVersion: cert-manager.io/v1
# kind: Certificate
# metadata:
#   namespace: nats-mcp
#   name: nats-monitor
# spec:
#   secretName: nats-monitor-tls
#   issuerRef:
#     name: letsencrypt
#     kind: ClusterIssuer
#   commonName: "nats.vilo.network"
#   dnsNames:
#     - "nats.vilo.network"
# ---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   namespace: nats-mcp
#   name: nats-monitor
#   annotations:
#     nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
# spec:
#   ingressClassName: nginx
#   tls:
#   - hosts:
#     - nats.vilo.network
#     secretName: nats-monitor-tls
#   rules:
#   - host: nats.vilo.network
#     http:
#       paths:
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: nats
#             port:
#               number: 8222
